
<!--
this code sucks but it kinda works so i'm keeping it.
-->
<html>
<head>
<script src="https://kihtrak.com/cloud_variable/cloudify.min.js"></script>
<style>
body {
  font: 100% arial;
}
table, th, td {
  border:1px solid black;
}
	</style>
<title>chatroom.</title>
</head>
<body>
<center>
<h1>chatroom.</h1>
<small>a terrible html based chatroom</small>

<script>

let firstperson = prompt("Please enter your name:", "");
c = 1
trimmedperson = firstperson.trim();
person = trimmedperson.toLowerCase();


test = (person == "brody" || person == "Brody" || person == "brodyh.net" || person == "chatroom" || person == "admin" || person == "brody h." || person == "brody h" || person == "Brody H." || person == "Brody H" || person == "brody " || person == "brody  ");
person = trimmedperson

if (test == true) {
	 var dpassword = prompt("This name requires a password:", "");
	 c = 0
}

password = btoa(dpassword) //alright now the password is better

if (password == "Z29vZ" + "CB" + String.fromCharCode(119) + "YXN" + String.fromCharCode(122) + "d29yZA" + "==") {
	 console.log("correct")
	 c = 1
}
else if (test == true && password != "Z29vZ" + "CB" + String.fromCharCode(119) + "YXN" + String.fromCharCode(122) + "d29yZA" + "==") {
	 console.log("incorrect")
	 location.reload();
}
var pastmessage = ""
</script>

<table style="width:75%">
   <tr>
    <td id="8">-----</td>
  </tr>
     <tr>
    <td id="7">-----</td>
  </tr>
   <tr>
    <td id="6">-----</td>
  </tr>
 <tr>
    <td id="5"><center>Loading...</center></td>
  </tr>
   <tr>
    <td id="4"><center><small>If the chat has been loading for more than 15 seconds, revisit the chat later, or click the troubleshoot link at the bottom.</small></center></td>
  </tr>
  <tr>
    <td id="3">-----</td>
  </tr>
  <tr>
    <td id="2"><small>v-0.3 (patch 2)</small></td>
  </tr>
  <tr>
    <td id="1">-----</td>
  </tr>
</table>

<script>
setInterval(update, 500);

function update() {
  	 document.getElementById("1").innerHTML = cloud_one;
	 document.getElementById("2").innerHTML = cloud_two;
	 document.getElementById("3").innerHTML = cloud_three;
	 document.getElementById("4").innerHTML = cloud_four;
	 document.getElementById("5").innerHTML = cloud_five;
	 document.getElementById("6").innerHTML = cloud_six;
	 document.getElementById("7").innerHTML = cloud_seven;
	 document.getElementById("8").innerHTML = cloud_eight;
	 if (typeof cloud_one !== 'undefined') {
		 document.getElementById("coolbutton").removeAttribute("hidden");
		 document.getElementById("message").removeAttribute("hidden");
		 document.getElementById("sendcolor").removeAttribute("hidden");
		 document.getElementById("sendimage").removeAttribute("hidden"); 
	 }
}

</script>

<input hidden type="text" id="message" placeholder="Message" size="70" autocomplete="off">
<button hidden type="submit" onclick="load()" id="coolbutton">Submit</button>

<br>
<br>
<br>
<br>
<button hidden type="submit" id="sendcolor" onclick="showcolor()">Change Name Color</button>
<button hidden type="submit" id="sendimage" onclick="showimage()">Send Image</button>
<br>
<br>

<i style='font-size:10px;color:#b8b8b8;'><a href="https://www.brodyh.net/chatroom/troubleshoot.html"><small>Troubleshooting</small></a></i>

<p hidden id="colormenu">
<input type="color" id="colorthing" value="#ff0000" style="width:10%;">
<button type="submit" onclick="sendcolor()">Submit</button>
</p>

<p hidden id="imagemenu">
<input id="inp" type='file'>
<p id="b64"></p>
</p>

<a hidden>
really cool hidden menu

<p id="pastmessage"></p>

</a>



<script>
var sent = 0
var input = document.getElementById("message");

input.addEventListener("keyup", function(load) {
  if (event.keyCode === 13) {
   event.preventDefault();
   document.getElementById("coolbutton").click();
  }
});


function load() {
	 message = document.getElementById("message").value;
	 document.getElementById("colormenu").setAttribute("hidden", "true");
	 document.getElementById("imagemenu").setAttribute("hidden", "true");
	 pastmessage = document.getElementById("pastmessage").value;
	 

	 if (message == "") {
		 return
     }
	 if (message == pastmessage) {
		 document.getElementById("message").value = "";
		 alert("this is the spam filter (reason 1)");
		 return
     }
	 if (sent == 1) {
		 document.getElementById("message").value = "";
		 alert("this is the spam filter (reason 2)");
		 return
     }
	 sent = 1
	 setTimeout(() => {sent = 0;}, "1500")
	 
	 document.getElementById("pastmessage").value = message;
	 
	 document.getElementById("message").value = "";
	 
	 message = linkify(message)
	 
	 cloud_one = document.getElementById("1").innerHTML;
	 cloud_two = document.getElementById("2").innerHTML;
	 cloud_three = document.getElementById("3").innerHTML;
	 cloud_four = document.getElementById("4").innerHTML;
	 cloud_five = document.getElementById("5").innerHTML;
	 cloud_six = document.getElementById("6").innerHTML;
	 cloud_seven = document.getElementById("7").innerHTML;
	 cloud_eight = document.getElementById("8").innerHTML;
	 
	 cloud_eight = cloud_seven;
	 cloud_seven = cloud_six;
	 cloud_six = cloud_five;
	 cloud_five = cloud_four;
	 cloud_four = cloud_three;
	 cloud_three = cloud_two;
	 cloud_two = cloud_one;
	 
	 namecolor = document.getElementById("colorthing").value;
	 var today = new Date();
	 var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
	 var hiddendate = today.getMonth() + "/" + today.getDate() + "/" + today.getFullYear();
	 cloud_one = "<p style='color:blue;'><b style='color:" + namecolor + ";'>" + person + ": </b>" + message + " ";
	 cloud_one = cloud_one + "<i style='font-size:10px;color:#b8b8b8;'>" + time + "<a hidden>" + hiddendate + "</a></i></p>"
	 
	 document.getElementById("1").innerHTML = cloud_one;
	 document.getElementById("2").innerHTML = cloud_two;
	 document.getElementById("3").innerHTML = cloud_three;
	 document.getElementById("4").innerHTML = cloud_four;
	 document.getElementById("5").innerHTML = cloud_five;
	 document.getElementById("6").innerHTML = cloud_six;
	 document.getElementById("7").innerHTML = cloud_seven;
	 document.getElementById("8").innerHTML = cloud_eight;
	 cloud_chatlog = cloud_chatlog + "<br>" + cloud_two
}


function showcolor() {
	 document.getElementById("colormenu").removeAttribute("hidden");
	 namecolor = document.getElementById("colorthing").value;
}

function showimage() {
	 document.getElementById("imagemenu").removeAttribute("hidden");
}

function sendcolor() {
	 document.getElementById("colormenu").setAttribute("hidden", "true");
	 
}

function readFile() {
  
  if (this.files && this.files[0]) {
    
    var FR= new FileReader();
    
    FR.addEventListener("load", function(e) {
      image = e.target.result;
	  message = "<img height='200' src=" + image + "></img>"
	  mycodesucks()
    }); 
    
    FR.readAsDataURL( this.files[0] );
  }
  
}

function mycodesucks() {
	 var sent = 1;
	 setTimeout(() => {var sent = 0;}, "3000")
	 document.getElementById("imagemenu").setAttribute("hidden", "true");
	 cloud_one = document.getElementById("1").innerHTML;
	 cloud_two = document.getElementById("2").innerHTML;
	 cloud_three = document.getElementById("3").innerHTML;
	 cloud_four = document.getElementById("4").innerHTML;
	 cloud_five = document.getElementById("5").innerHTML;
	 cloud_six = document.getElementById("6").innerHTML;
	 cloud_seven = document.getElementById("7").innerHTML;
	 cloud_eight = document.getElementById("8").innerHTML;
	 
	 cloud_eight = cloud_seven;
	 cloud_seven = cloud_six;
	 cloud_six = cloud_five;
	 cloud_five = cloud_four;
	 cloud_four = cloud_three;
	 cloud_three = cloud_two;
	 cloud_two = cloud_one;
	 
	 namecolor = document.getElementById("colorthing").value;
	 var today = new Date();
	 var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
	 var hiddendate = today.getMonth() + "/" + today.getDate() + "/" + today.getFullYear();
	 cloud_one = "<p style='color:blue;'><b style='color:" + namecolor + ";'>" + person + ": </b>" + message + " ";
	 cloud_one = cloud_one + "<i style='font-size:10px;color:#b8b8b8;'>" + time + "<a hidden>" + hiddendate + "</a></i></p>"
	 
	 document.getElementById("1").innerHTML = cloud_one;
	 document.getElementById("2").innerHTML = cloud_two;
	 document.getElementById("3").innerHTML = cloud_three;
	 document.getElementById("4").innerHTML = cloud_four;
	 document.getElementById("5").innerHTML = cloud_five;
	 document.getElementById("6").innerHTML = cloud_six;
	 document.getElementById("7").innerHTML = cloud_seven;
	 document.getElementById("8").innerHTML = cloud_eight;
}

//the following is stole from "https://stackoverflow.com/questions/37684/how-to-replace-plain-urls-with-links"
function linkify(inputText) {
    var replacedText, replacePattern1, replacePattern2, replacePattern3;

    //URLs starting with http://, https://, or ftp://
    replacePattern1 = /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;
    replacedText = inputText.replace(replacePattern1, '<a href="$1">$1</a>');

    //URLs starting with "www." (without // before it, or it'd re-link the ones done above).
    replacePattern2 = /(^|[^\/])(www\.[\S]+(\b|$))/gim;
    replacedText = replacedText.replace(replacePattern2, '$1<a href="http://$2">$2</a>');

    //Change email addresses to mailto:: links.
    replacePattern3 = /(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim;
    replacedText = replacedText.replace(replacePattern3, '<a href="mailto:$1">$1</a>');

    return replacedText;
}
//end of stolen code.
function debugload() {
	cloud_one = "-----"
	cloud_two = "-----"
	cloud_three = "-----"
	cloud_four = "-----"
	cloud_five = "-----"
	cloud_six = "-----"
	cloud_seven = "-----"
	cloud_eight = "-----"
	cloud_chatlog = ""
}

document.getElementById("inp").addEventListener("change", readFile);

</script>
